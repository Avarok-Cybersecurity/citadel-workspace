# Architecture Overview

## System Architecture

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                              FRONTEND (Browser)                             │
├─────────────────────────────────────────────────────────────────────────────┤
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐    │
│  │ UI Plugin A  │  │ UI Plugin B  │  │ UI Plugin C  │  │     ...      │    │
│  └──────┬───────┘  └──────┬───────┘  └──────┬───────┘  └──────────────┘    │
│         │                 │                 │                               │
│  ┌──────▼─────────────────▼─────────────────▼──────────────────────────┐   │
│  │                     Plugin Host (Sandbox)                            │   │
│  │  • IFrame isolation  • Permission enforcement  • Message routing     │   │
│  └──────────────────────────────┬───────────────────────────────────────┘   │
│                                 │                                           │
│  ┌──────────────────────────────▼───────────────────────────────────────┐   │
│  │                     Plugin Handle (API Surface)                       │   │
│  │  • UI Manipulation  • MDX Access  • Signal Emission  • Data Access   │   │
│  └──────────────────────────────┬───────────────────────────────────────┘   │
│                                 │                                           │
│  ┌──────────────────────────────▼───────────────────────────────────────┐   │
│  │                     Core Workspace UI (React)                         │   │
│  │  • Event Emitter  • MDX Renderer  • Component Registry               │   │
│  └──────────────────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────────────────┘
                                      │ WebSocket
                                      ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                              BACKEND (Server)                               │
├─────────────────────────────────────────────────────────────────────────────┤
│  ┌──────────────────────────────────────────────────────────────────────┐   │
│  │                     Internal Service (Rust)                           │   │
│  │  • Session Management  • P2P Brokering  • Plugin Request Routing     │   │
│  └──────────────────────────────────────────────────────────────────────┘   │
│                                      │                                      │
│  ┌──────────────────────────────────────────────────────────────────────┐   │
│  │                     Workspace Server Kernel                           │   │
│  │  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐       │   │
│  │  │ Backend Plugin  │  │ Backend Plugin  │  │       ...       │       │   │
│  │  │       A         │  │       B         │  │                 │       │   │
│  │  └────────┬────────┘  └────────┬────────┘  └─────────────────┘       │   │
│  │           │                    │                                      │   │
│  │  ┌────────▼────────────────────▼─────────────────────────────────┐   │   │
│  │  │              Plugin Runtime (Sandboxed WASM or Native)         │   │   │
│  │  │  • Capability grants  • Resource limits  • Syscall filtering  │   │   │
│  │  └───────────────────────────────────────────────────────────────┘   │   │
│  │                                      │                               │   │
│  │  ┌───────────────────────────────────▼───────────────────────────┐   │   │
│  │  │              Backend Plugin Handle (API Surface)               │   │   │
│  │  │  • Filesystem  • Network  • Process  • Signals  • Data        │   │   │
│  │  └───────────────────────────────────────────────────────────────┘   │   │
│  └──────────────────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────────────────┘
```

## Plugin Communication Flow

```
┌─────────────┐      ┌─────────────┐      ┌─────────────┐
│  UI Plugin  │ ──── │   Signal    │ ──── │  Backend    │
│             │      │   Bridge    │      │   Plugin    │
└─────────────┘      └─────────────┘      └─────────────┘
      │                    │                    │
      │                    ▼                    │
      │         ┌─────────────────┐             │
      │         │  Signal Router  │             │
      │         │   (Hierarchy)   │             │
      │         └─────────────────┘             │
      │                    │                    │
      ▼                    ▼                    ▼
┌─────────────────────────────────────────────────────┐
│              Workspace Domain Tree                   │
│                                                      │
│    Workspace                                         │
│    ├── Office A                                      │
│    │   ├── Room A1  ◄─── Signal originates here     │
│    │   └── Room A2                                   │
│    └── Office B                                      │
│        └── Room B1                                   │
└─────────────────────────────────────────────────────┘
```
